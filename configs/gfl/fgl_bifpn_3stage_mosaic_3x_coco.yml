

_BASE_: [
  '../datasets/coco_detection.yml',
  '../runtime.yml',
  '_base_/gfl_r50_bifpn_3stage.yml',
  '_base_/optimizer_1x.yml',
  '_base_/yolov5_reader.yml',
]

weights: output/fgl_bifpn_3stage_mosaic_3x_coco/model_final
find_unused_parameters: True

worker_num: 4
TrainReader:    
  sample_transforms:
    - Decode: {}
    - RandomFlip: {prob: 0.5}
    - RandomResize: {target_size: [640], random_interp: True, keep_ratio: True}
    - Mosaic: {target_size: 640, mosaic_border: [-320, -320]} #  # x y w h 
    - RandomPerspective: {degree: 0, translate: 0.1, scale: 0.5, shear: 0.0, perspective: 0.0, border: [-320, -320]} # x y w h 
    - NormalizeImage: {is_scale: true, mean: [0.485,0.456,0.406], std: [0.229, 0.224,0.225]}
    - Permute: {}
    
  batch_transforms:
  - PadBatch: {pad_to_stride: 32}
  - Gt2GFLTarget:
      downsample_ratios: [8, 16, 32]
      grid_cell_scale: 10

  batch_size: 8
  mosaic_epoch: 10000
  shuffle: true
  drop_last: true
  use_shared_memory: true


epoch: 36

LearningRate:
  base_lr: 0.01
  schedulers:
  - !PiecewiseDecay
    gamma: 0.1
    milestones: [24, 33]
  - !LinearWarmup
    start_factor: 0.1
    steps: 1500

OptimizerBuilder:
  optimizer:
    momentum: 0.9
    type: Momentum
  regularizer:
    factor: 0.0001
    type: L2
